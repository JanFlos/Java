package dml;

import java.util.List;

import base.Lists;

public class CommandBuilder {

	public static String insertCommand(Metadata metadata) {

		String returningClause = "";
		List<String> returningColumns = metadata.getReturningColumns();
		if (returningColumns != null) {

			String lCols = Lists.join(returningColumns, ", ");
			String lDummy = Lists.join("?", ", ", returningColumns.size());

			returningClause = String.format(" returning %s into %s", lCols, lDummy);
		}

		List<String> readWriteColumns = metadata.getInsertableColumns();
		String readWriteColumnList = Lists.join(readWriteColumns, ", ");
		String parameterList = Lists.join("?", ", ", readWriteColumns.size());
		String tableName = metadata.getTableName();

		return String.format("{call insert into %s (%s) values (%s)%s}", tableName, readWriteColumnList, parameterList, returningClause);

	}

	public static String deleteCommand(Metadata metadata) {

		String tableName = metadata.getTableName();
		String primaryKeyList = Lists.join(metadata.getPrimaryKeyColumns(), " and ", " = ?");

		return String.format("{call delete from %s where %s}", tableName, primaryKeyList);

	}

	public static String lockCommand(String tableName, List<String> primaryKey) {

		return String.format("select * from %s where %s for update", tableName, Lists.join(primaryKey, " and ", " = ?"));

	}

	public static String updateCommand(Metadata metadata) {

		String tableName = metadata.getTableName();
		String updatedColumns = Lists.join(metadata.getUpdateableColumns(), ", ", " = ?");
		String primaryKeyList = Lists.join(metadata.getPrimaryKeyColumns(), " and ", " = ?");

		return String.format("{call update %s set %s where %s}", tableName, updatedColumns, primaryKeyList);
	}
}
